# FreeRTOS Binary Semaphores

## FreeRTOS二进制信号量

二进制信号量能够实现互斥和同步。

二进制信号量和互斥量非常相似，但有一些细微的区别: 互斥量具备优先级继承机制，二进制信号量则不具备。因此，二进制信号量是实现同步(任务之间或任务与中断之间)的更好选择，而互斥体成为实现简单互斥的更好选择。互斥体如何用作互斥机制的描述同样适用于二进制信号量。本小节将仅描述二进制信号量实现同步的内容。

信号量API函数允许指定阻塞时间。阻塞时间表示 - 如果尝试“获取”的信号量不是立即可用的，任务应进入阻塞状态的最大“滴答”数。如果多个任务阻塞同时在同一个信号量上，那么具有最高优先级的任务将是下一次信号量可用时解除阻塞的任务。

二进制信号量可以被视为只能容纳一个item的队列。因此队列只能是空的或满的(因此是二进制的)。使用队列的任务和中断不关心队列包含什么——只需要知道队列是空的还是满的。可以利用这种机制来同步(例如)任务与中断。 

在使用任务为外围设备提供服务的情况中，采用轮询的方式会浪费CPU资源，并阻止其他任务执行。因此，任务最好将大部分时间都花在阻塞状态（允许其他任务执行）并且仅在需要处理数据时才执行。这是通过使用二进制信号量，在尝试“获取”信号量时阻塞任务来实现的。然后为外设编写一个中断例程，当外设需要服务时，该程序仅“给出”信号量。任务总是“获取”信号量（从队列中读取以使队列为空），但从不“提供”它。中断总是“给出”信号量（写入队列以使其满）但从不接受它。 [xSemaphoreGiveFromISR()](https://freertos.org/a00124.html)文档页面上提供的源代码应该更清楚这一点。另请参阅[RTOS任务通知](https://freertos.org/RTOS-task-notifications.html)，它可以在某些情况下用作更快、更轻量级的二进制信号量替代方案。

任务优先级可用于确保外设及时获得服务-有效地生成“延迟中断”方案。(注意，FreeRTOS也有一个[内置的延迟中断机制](https://freertos.org/xTimerPendFunctionCallFromISR.html))。另一种方法是使用队列代替信号量。这种方案中，中断例程可以捕获与外设事件相关的数据，并将其发送到任务队列中。当队列中的数据可用时，任务会解除阻塞，从队列中检索数据，然后进行相关数据处理。第二种方案允许中断保持尽可能短，所有的后续处理都发生在一个任务中。 

有关信号量相关API函数的列表，请参阅用户文档的[信号量/互斥量](https://freertos.org/a00113.html)部分。搜索FreeRTOS/Demo/Common/Minimal目录中的文件将显示其用法的多个示例。请注意，中断不得使用不以“FromISR”结尾的API函数。

![FreeRTOS二进制信号量](https://freertos.org/fr-content-src/uploads/2018/07/binary-semaphore.gif "二进制信号量通过任务实现同步")
