# FreeRTOS Mutexes

# FreeRTOS互斥锁

**互斥锁是具备优先级继承机制的二进制信号量**。 二进制信号量是实现**同步**(任务之间或任务与中断之间)的更好选择，而互斥锁是实现简单**互斥**（因此是“MUT”ual 'EX'clusion）的更好选择。

用于互斥时，互斥锁可视为一个用于**保护资源**的令牌。当任务需要访问资源时，它必须首先获取(“take”)令牌。 当互斥锁完成资源的使用后，它必须“返还”令牌——允许其他任务能够访问相同的资源。 

互斥锁使用与信号量相同的API函数，因此也允许指定阻塞时间。阻塞时间表示如果互斥量不是立即可用的，则在尝试“获取”互斥量时，任务应进入阻塞状态的最大“滴答”数。 然而，与二进制信号量不同-互斥量采用**优先级继承**。**这意味着如果高优先级任务在尝试获取当前由较低优先级任务持有的互斥量(令牌)时阻塞，则占用互斥量的任务的优先级会暂时提高到与阻塞任务相等的优先级**。该机制旨在确保较高优先级的任务在尽可能短的时间内保持在阻塞状态，从而最大限度地减少已经发生的“优先级反转”。

**优先级继承并不能避免优先级反转现象。该机制只是在某些情况下最小化其影响**。硬实时应用程序设计时应该首先考虑优先级反转的问题。 

互斥锁不应在中断中使用，理由如下:  

*   互斥锁包括一个优先级继承机制，互斥锁只有从任务中给出和获取时才有意义，而不是中断。

*   中断不能阻塞以等待由互斥锁保护的资源变为可用。

![FreeRTOS互斥锁](https://freertos.org/fr-content-src/uploads/2018/07/mutexes.gif "使用互斥锁来保护对共享资源的访问")
